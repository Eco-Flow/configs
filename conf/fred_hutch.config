params {
    config_profile_name        = 'Fred Hutch'
    config_profile_description = 'Fred Hutch Cancer Center HPC profile'
    config_profile_contact     = ''
    config_profile_url         = 'https://sciwiki.fredhutch.org/'
    // Same as resourceLimits, but for older pipelines
    max_memory = 700.GB
    max_cpus = 36
    max_time = 720.h
    // Assumes user will provide a scratch dir at runtime
    scratch = null
}


process {
    executor = 'slurm'
    // clusterOptions = {} // If we want default slurm configs
    queue = { task.time >= 12.h ? 'campus-new' : 'short' }
    maxRetries = 2
    resourceLimits = [
        memory: 700.GB,
        cpus: 36,
        time: 720.h
    ]
    // Maybe not desirable to rely on the module, but this enforces Apptainer to be loaded since we're defaulting apptainer to be enabled
    beforeScript = """
    module load Apptainer
    """
}

executor {
    // How many jobs can be submitted at once
    queueSize = 16
    // Maximum jobs per second
    submitRateLimit = "10/1sec"
}

apptainer {
    enabled = true
    // If the user does not provide a scratch directory, use their home dir
    cacheDir = params.scratch ? "${params.scratch}" : "${System.getenv('HOME')}/.apptainer/cache/library"
    // Checks if TMPDIR is defined in the environment before mounting to avoid breaks
    runOptions = "--containall" + System.getenv('TMPDIR') ?: "-B \$TMPDIR"
}

// If the user does not provide a scratch directory, use their home dir
workDir = params.scratch ? "${params.scratch}" : "${System.getenv('HOME')}/nextflow"

// clean the generated files in the working directory
// having this as true sometimes breaks things
cleanup = false
