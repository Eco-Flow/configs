params {
    config_profile_name        = 'Fred Hutch'
    config_profile_description = 'Fred Hutch Cancer Center HPC profile'
    config_profile_contact     = ''
    config_profile_url         = 'https://sciwiki.fredhutch.org/'
    // Same as resourceLimits, but for older pipelines
    max_memory = 700.GB
    max_cpus = 36
    max_time = 720.h
    scratch = null
}


process {
    executor = 'slurm'
    // clusterOptions = {}
    queue = { task.time >= 12.h ? 'campus-new' : 'short' }
    maxRetries = 2
    resourceLimits = [
        memory: 700.GB,
        cpus: 36,
        time: 720.h
    ]
    beforeScript = """
    module load Apptainer
    """
    // env.NXF_APPTAINER_CACHEDIR = "$HOME/.apptainer/cache"
}

executor {
    // How many jobs can be submitted at once
    queueSize = 16
    // Maximum jobs per second
    submitRateLimit = "10/1sec"
}

apptainer {
    enabled = true
    cacheDir = params.scratch ? "${params.scratch}" : "${System.getenv('HOME')}/.apptainer/cache/library"
    // runOptions = "--containall -B ${System.getenv('TMPDIR')}"
    runOptions = "--containall" + System.getenv('TMPDIR') ?: "-B \$TMPDIR"
}

workDir = params.scratch ? "${params.scratch}" : "${System.getenv('HOME')}/nextflow"

// clean the generated files in the working directory
// having this as true sometimes breaks things
cleanup = false
